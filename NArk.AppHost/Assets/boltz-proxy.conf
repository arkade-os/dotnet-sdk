upstream boltz_api {
  server boltz:9001;
}

upstream boltz_sidecar {
  server boltz:9005;
}

upstream boltz_ws {
  server boltz:9004;
}

server {
  listen 9069;

  # WebSocket endpoint served by sidecar
  location /v2/ws {
    proxy_pass http://boltz_ws;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_read_timeout 86400s;
  }

  # Sidecar-served endpoints
  location /v2/swap/restore {
    proxy_pass http://boltz_sidecar;
  }

  # Everything else goes to the main API
  location / {
    proxy_pass http://boltz_api;
  }
}
